// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Modelos de Usuario
model Usuario {
  id        Int      @id @default(autoincrement())
  dni       String   @unique @db.VarChar(8)
  nombres   String   @db.VarChar(100)
  apellidos String   @db.VarChar(100)
  email     String?  @db.VarChar(100)
  password  String   @db.VarChar(255)
  rol       Rol      @default(ALUMNO)
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  alumno   Alumno?
  profesor Profesor?

  @@map("usuarios")
}

enum Rol {
  ALUMNO
  PROFESOR
  ADMIN
}

// Modelos Académicos
model Grado {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(50) // "1° Primaria", "1° Secundaria", etc.
  nivel     Nivel
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  secciones Seccion[]
  cursos    Curso[]

  @@map("grados")
}

enum Nivel {
  PRIMARIA
  SECUNDARIA
}

model Seccion {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(10) // "A", "B", "C"
  gradoId   Int
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  grado     Grado    @relation(fields: [gradoId], references: [id])
  alumnos   Alumno[]
  horarios  Horario[]

  @@unique([gradoId, nombre])
  @@map("secciones")
}

model Turno {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(50) // "Mañana", "Tarde", "Noche"
  horaInicio String  @db.VarChar(5) // "08:00"
  horaFin    String  @db.VarChar(5) // "13:00"
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  horarios Horario[]

  @@map("turnos")
}

model Curso {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(100)
  codigo    String   @unique @db.VarChar(20)
  gradoId   Int
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  grado    Grado     @relation(fields: [gradoId], references: [id])
  horarios Horario[]

  @@map("cursos")
}

model Horario {
  id        Int      @id @default(autoincrement())
  diaSemana Int      // 1=Lunes, 2=Martes, ..., 7=Domingo
  horaInicio String  @db.VarChar(5)
  horaFin    String  @db.VarChar(5)
  cursoId   Int
  seccionId Int
  turnoId   Int
  profesorId Int
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  curso     Curso    @relation(fields: [cursoId], references: [id])
  seccion   Seccion  @relation(fields: [seccionId], references: [id])
  turno     Turno    @relation(fields: [turnoId], references: [id])
  profesor  Profesor @relation(fields: [profesorId], references: [id])
  asistencias Asistencia[]

  @@map("horarios")
}

// Modelos de Personas
model Alumno {
  id        Int      @id @default(autoincrement())
  usuarioId Int      @unique
  codigo    String   @unique @db.VarChar(20)
  seccionId Int
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  seccion   Seccion  @relation(fields: [seccionId], references: [id])
  asistencias Asistencia[]

  @@map("alumnos")
}

model Profesor {
  id        Int      @id @default(autoincrement())
  usuarioId Int      @unique
  codigo    String   @unique @db.VarChar(20)
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  horarios  Horario[]

  @@map("profesores")
}

// Modelo de Asistencias
model Asistencia {
  id        Int      @id @default(autoincrement())
  fecha     DateTime @db.Date
  estado    EstadoAsistencia
  observacion String? @db.Text
  horarioId Int
  alumnoId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  horario   Horario  @relation(fields: [horarioId], references: [id])
  alumno    Alumno   @relation(fields: [alumnoId], references: [id])

  @@unique([fecha, horarioId, alumnoId])
  @@map("asistencias")
}

enum EstadoAsistencia {
  PRESENTE
  TARDANZA
  FALTA
  JUSTIFICADA
}
